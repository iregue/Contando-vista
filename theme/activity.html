<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="assets/img/favorites-star-icon.png">

    <title>Counting Stars</title>

    <!-- Bootstrap core CSS -->
    <link href="assets/css/bootstrap.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="assets/css/style.css" rel="stylesheet">
    <link href="assets/css/font-awesome.min.css" rel="stylesheet">


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <script src="assets/js/validator/validator.js"></script>

    <script src="https://www.gstatic.com/charts/loader.js"></script>
    <!-- Pluging para cookies-->
    <script src="assets/js/jquery.cookie.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/1.0.10/cookieconsent.min.js"></script>
    <!-- End Cookie Consent plugin -->


</head>
<body>

<!-- Fixed navbar -->
<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="index.html">Contando estrellas</a>
        </div>
        <div class="navbar-collapse collapse navbar-right">
            <ul class="nav navbar-nav">
                <li><a href="index.html">Inicio</a></li>
                <li><a href="registro.html">Registro</a></li>
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Analizar<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li><a href="stats.html">Observaciones por país</a></li>
                        <li><a href="activity.html">Actividad de estrellas</a></li>
                    </ul>
                </li>
                <li><a href="about.html">Acerca de</a></li>
                <li><a href="settings.html">Ajustes</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Últimos eventos <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li><a href="perseidas16.html">Perseidas 2016</a></li>
                        <li><a href="#">Perseidas 2015</a></li>
                    </ul>
                </li>
            </ul>
        </div><!--/.nav-collapse -->
    </div>
</div>
<!-----------------------------------FORMULARIO------------------------------------------------------------>
<div class="container mtb">
    <div class="row">
        <div class="col-md-3">

            <h2>Observaciones por país</h2>
            <br>
            <h4>Muestra las observaciones emitidas por los usuarios en cada pais </h4>
            <br>
            <form>
                <div class="form-group">
                    <label>Latitud</label>
                    <input type="text" name="latitude" id="latitude" class="form-control" placeholder="">
                </div>
                <div class="form-group">
                    <label>Longitud</label>
                    <input type="text" name="longitude" id="longitude" class="form-control" placeholder="">
                </div>
                <div class="form-group">
                    <label>Distancia máxima a [Latitud,Longitud] en Km</label>
                    <input type="text" name="distance" id="distance" class="form-control" pattern="^[\d.]+$" placeholder="" >
                </div>
                <div class="form-group">
                    <label>Fecha de inicio</label>
                    <input type="text" class="form-control" name="start_date" id="start_date" placeholder="">
                </div>
                <div class="form-group">
                    <label>Fecha final</label>
                    <input type="text" class="form-control" name="end_date" id="end_date" placeholder="">
                </div>
                <div class="form-group">
                    <label for="nivel_detalle">Nivel de detalle</label>
                    <select class="form-control" id="nivel_detalle" name="nivel_detalle">
                        <option value="30">30 minutos</option>
                        <option value="60">1 hora</option>
                        <option value="1440">1 día</option>
                    </select>
                </div>
                <div class="row col-xs-offset-1">
                    <button type="button" onclick="getActivity()" class="btn btn-danger btn-lg">Enviar</button>
                </div>
                <div class="row col-xs-offset-1"><br>
                    <button type="button" onclick="clearAl()" class="btn btn-primary btn-md">Limpiar mapa</button>
                </div>
            </form>
            </div>
        <div class="col-md-9">
        <h4>Observaciones por países</h4><br>

        <div class="row" id="chart_div"></div>
            </div>
        </div>
    </div>
<!-- *****************************************************************************************************************
    FOOTER
    ***************************************************************************************************************** -->
<div id="footerwrap">
    <div class="container">
        <div class="row">
            <div class="col-lg-4">
                <h4>Acerca de</h4>
                <div class="hline-w"></div>
                <p>Esta aplicación ha sido creada para dar soporte a eventos astronómicos con la que se pueda llevar un seguimiento de los bólidos avistados. <br><a href="about.html">Más información</a></p>
            </div>
            <div class="col-lg-4">
                <h4>Desarrollador</h4>
                <div class="hline-w"></div>
                <p>Ignacio Regueiro Tuñon alumno de la Escuela Técnica Superior de Ingenieros Informáticos de la Universidad Politécnica de Madrid ha realizado esta aplicación como trabajo de fin de grado.
                    <br><a href="https://twitter.com/IgnaRegue"><i class="fa fa-twitter"></i></a>
                </p>
            </div>
            <div class="col-lg-4">
                <h4>Donde estamos</h4>
                <div class="hline-w"></div>
                <p>
                    C/ Campus de Montegancedo, s/n<br/>
                    Facultad de Informática-Universidad Politécnica de Madrid<br/>
                    28660-Madrid<br/>
                </p>
            </div>

        </div><! --/row -->
    </div><! --/container -->
</div><! --/footerwrap -->
</body>

<!-- Bootstrap core JavaScript
       ================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="assets/js/bootstrap.min.js"></script>
<script src="assets/js/retina-1.1.0.js"></script>
<script src="assets/js/jquery.hoverdir.js"></script>
<script src="assets/js/jquery.hoverex.min.js"></script>
<script src="assets/js/jquery.prettyPhoto.js"></script>
<script src="assets/js/jquery.isotope.min.js"></script>
<script src="assets/js/custom.js"></script>
<script src="assets/js/jquery.cookie.js"></script>

<script>

    if(screen.width < 426){
        $("#regions_div").css("width","300px");
        $("#chart_div").css("width","300px");
        $("#regions_div").css("height","300px");
        $("#regions_div").css("margin-left","0px");
        $("#chart_div").css("height","300px");
        //    style="width: 310px; height: 310px;

    }
    if(screen.width > 425 && screen.width <1024){
        $("#regions_div").css("width","510px");
        $("#chart_div").css("width","510px");
        $("#regions_div").css("height","410px");
        $("#regions_div").css("margin-left","0px");
        $("#chart_div").css("height","410px");

        //$("#regions_div").css("padding","100px 0 0");
        //    style="width: 310px; height: 310px;

    }
window.cookieconsent_options = {"message":"This website uses cookies to ensure you get the best experience on our website","dismiss":"Got it!","learnMore":"More info","link":null,"theme":"light-bottom"};

function getActivity() {


var _latitude= $('#latitude').val();
var _longitude= $('#longitude').val();
var _distance= $('#distance').val();
var _start_date= $('#start_date').val();
var _end_date= $('#end_date').val();
var _detail = $('#nivel_detalle').val();

$.cookie('latitude3', _latitude);
 $.cookie('longitude3', _longitude);
 $.cookie('distance3', _distance);
 $.cookie('startdate3', _start_date);
 $.cookie('enddate3', _end_date);
 $.cookie('detail', _detail);


/*$.cookie('latitude2','');
 $.cookie('longitude2', '');
 $.cookie('distance2', '');
 $.cookie('startdate2', '');
 $.cookie('enddate2', '');*/
 $('#latitude').val($.cookie('latitude3'));
 $('#longitude').val($.cookie('longitude3'));
 $('#distance').val($.cookie('distance3'));
 $('#start_date').val($.cookie('startdate3'));
 $('#end_date').val($.cookie('enddate3'));
 $('#nivel_detalle').val($.cookie('detail'));

    //2016-12-22T16:42:55.929Z


$.get("http://localhost/api/observations?lat=" + _latitude + "&lon=" + _longitude + "&distance=" + _distance + "&startdate=" + _start_date + "&enddate=" + _end_date, function (data) {
    alert("start");

    var total = data.total;
    var limit = data.limit;
    var pages = data.pages;
    var resto = total % limit;
    var pagesCounter = 1;
    var temp_date = data.docs[0].date;
    var date0 = temp_date.split("T");
    var date1 = date0[0].split("-");
    var start_year = date1[0];
    var start_month = date1[1];
    var start_day = date1[2];
    var date2 = date0[1].split(".");
    var date3 = date2[0].split(":");
    var start_hours = date3[0];
    var start_minutes = date3[1];
    var start_seconds = date3[2];
    var next_section_minutes = start_minutes;
    var next_section_hours = start_hours;
    var next_section_days = start_day;
    var next_section_month = start_month;
    var next_section_year = start_year;

    if(_detail==30){
        next_section_minutes = next_section_minutes + 30;
        if(next_section_minutes> 60){
            next_section_minutes = next_section_minutes - 60;
            next_section_hours = next_section_hours + 1;
            if(next_section_hours>24){
                next_section_hours = 0;
                next_section_days = next_section_days +1;
                if(next_section_days == 29 && next_section_month == 2){
                    //case febrero
                    next_section_days = 0;
                    next_section_month = 3;
                }
                if(next_section_days == 31 && (next_section_month== 4 || next_section_month == 6 || next_section_month == 9 || next_section_month ==1)){
                    //caso abril, junio, septiembre, noviembre
                    next_section_days = 0;
                    if(next_section_month == 4){
                        next_section_month = 5;
                    }
                    if(next_section_month == 6){
                    next_section_month = 7;

                }
                    if(next_section_month == 9){
                    next_section_month = 10;

                }
                    if(next_section_month == 11){
                    next_section_month = 12;

                }
                }
                if(next_section_days == 32){
                    if(next_section_month == 1){
                        next_section_month =2;
                    }
                    if(next_section_month == 3){
                        next_section_month = 4;
                    }
                    if(next_section_month == 5){
                        next_section_month = 6;
                    }
                    if(next_section_month == 7){
                        next_section_month = 8;
                    }
                    if(next_section_month == 8){
                        next_section_month = 9;

                    }
                    if(next_section_month == 10){
                        next_section_month = 11;

                    }
                    if(next_section_month == 12){
                        next_section_month = 1;
                        next_section_year = next_section_year + 1;

                    }
                }
            }
        }
    }
    if(_detail==60){
        next_section_hours = next_section_hours + 1;
        if(next_section_hours>24){
            next_section_hours = 0;
            next_section_days = next_section_days +1;
            if(next_section_days == 29 && next_section_month == 2){
                //case febrero
                next_section_days = 0;
                next_section_month = 3;
            }
            if(next_section_days == 31 && (next_section_month== 4 || next_section_month == 6 || next_section_month == 9 || next_section_month ==1)){
                //caso abril, junio, septiembre, noviembre
                next_section_days = 0;
                if(next_section_month == 4){
                    next_section_month = 5;
                }
                if(next_section_month == 6){
                    next_section_month = 7;

                }
                if(next_section_month == 9){
                    next_section_month = 10;

                }
                if(next_section_month == 11){
                    next_section_month = 12;

                }
            }
            if(next_section_days == 32){
                if(next_section_month == 1){
                    next_section_month =2;
                }
                if(next_section_month == 3){
                    next_section_month = 4;
                }
                if(next_section_month == 5){
                    next_section_month = 6;
                }
                if(next_section_month == 7){
                    next_section_month = 8;
                }
                if(next_section_month == 8){
                    next_section_month = 9;

                }
                if(next_section_month == 10){
                    next_section_month = 11;

                }
                if(next_section_month == 12){
                    next_section_month = 1;
                    next_section_year = next_section_year + 1;

                }
            }
        }
    }
    if(_detail==1440){
        next_section_days = next_section_days +1;
        if(next_section_days == 29 && next_section_month == 2){
            //case febrero
            next_section_days = 0;
            next_section_month = 3;
        }
        if(next_section_days == 31 && (next_section_month== 4 || next_section_month == 6 || next_section_month == 9 || next_section_month ==1)){
            //caso abril, junio, septiembre, noviembre
            next_section_days = 0;
            if(next_section_month == 4){
                next_section_month = 5;
            }
            if(next_section_month == 6){
                next_section_month = 7;

            }
            if(next_section_month == 9){
                next_section_month = 10;

            }
            if(next_section_month == 11){
                next_section_month = 12;

            }
        }
        if(next_section_days == 32){
            if(next_section_month == 1){
                next_section_month =2;
            }
            if(next_section_month == 3){
                next_section_month = 4;
            }
            if(next_section_month == 5){
                next_section_month = 6;
            }
            if(next_section_month == 7){
                next_section_month = 8;
            }
            if(next_section_month == 8){
                next_section_month = 9;

            }
            if(next_section_month == 10){
                next_section_month = 11;

            }
            if(next_section_month == 12){
                next_section_month = 1;
                next_section_year = next_section_year + 1;

            }
        }
    }

    if(pages==1){
        var cont = 0;
        var contAux = cont +1;
        while (cont < resto) {
            var temp_date = data.docs[cont].date;
            var date0 = temp_date.split("T");
            var date1 = date0[0].split("-");
            var _year = date1[0];
            var _month = date1[1];
            var _day = date1[2];
            var date2 = date0[1].split(".");
            var date3 = date2[0].split(":");
            var _hours = date3[0];
            var _minutes = date3[1];
            var _seconds = date3[2];
            if(contAux < resto){
                    var temp_date2 = data.docs[contAux].date;
                    var date02 = temp_date2.split("T");
                    var date12 = date02[0].split("-");
                    var _year2 = date12[0];
                    var _month2 = date12[1];
                    var _day2 = date12[2];
                    var date22 = date02[1].split(".");
                    var date32 = date22[0].split(":");
                    var _hours2 = date32[0];
                    var _minutes2 = date32[1];
                    var _seconds2 = date32[2];

                    /////////////////////////////////CHECK hora en cambios de minutos horas y dias///////////////////////
                    if(_seconds > 54 && _minutes ==59 && _hours ==23){
                        var check_seconds = _seconds +5 - 60;
                        var check_minutes = 0;
                        var check_hours = 0;
                    }
                    if(_seconds > 54 && _minutes == 59 && _hours != 23){
                        var check_seconds = _seconds +5 - 60;
                        var check_minutes = 0;
                        var check_hours = _hours +1;
                    }
                    if(_seconds > 54 && _minutes != 59 && _hours != 23){
                        var check_seconds = _seconds +5 - 60;
                        var check_minutes = _minutes +1;
                        var check_hours = _hours +1;
                    }
                    ///////////////////////////////////////////////////////////////////////////////////////////////////////
                ///////////// CHECK de misma observacion    ////////////////////////////////////////////////////////////////
                if(_year == _year2 && _month == _month2 && _day == _day2) {
                        var temp_second = _seconds + 5;
                        if (_hours == _hours2 && _minutes == _minutes2 && temp_second > _seconds2) {
                            //Coincide observacion
                            contAux = contAux +1;
                        } else {
                            //no coincide observacion

                        }
                        if (check_hours == _hours2 && check_minutes == _minutes2 && check_seconds > _seconds2) {
                            //coincide observacion
                            contAux = contAux +1;
                        } else {
                            //no coincide observacion
                        }
                    }
                    else{
                        //no coincide
                    }
            }
            else{
                //no hay otra observacion para comparar con la anterior
            }
            cont = cont + 1;
        }
    }
    else{
        //Page > 1
    }
   /* while (elementCounter < resto) {
        var temp_country = data.docs[elementCounter].country;
        //alert(temp_country);
        foundCountry(temp_country);
        elementCounter = elementCounter + 1;
    }*/
});

}
//var res = str.split("-",1);
    google.charts.load('current', {'packages':['corechart', 'line']});
    google.charts.setOnLoadCallback(drawChart);


    function drawChart() {
        var data = new google.visualization.DataTable();

        data.addColumn('date', 'Date');
        data.addColumn('number', 'Population');
        data.addRow([new Date(1300,1,1), 200]);
        data.addRows([
            [new Date(1400, 1, 1),  374],
            [new Date(1500, 1, 1),  460],
            [new Date(1600, 1, 1),  579],
            [new Date(1700, 1, 1),  679],
            [new Date(1750, 1, 1),  770],
            [new Date(1800, 1, 1),  954],
            [new Date(1850, 1, 1),  1241],
            [new Date(1900, 1, 1),  1633],
            [new Date(1910, 1, 1),  1750],
            [new Date(1920, 1, 1),  1860],
            [new Date(1930, 1, 1),  2070],
            [new Date(1940, 1, 1),  2300],
            [new Date(1950, 1, 1),  2558],
            [new Date(1951, 1, 1),  2595],
            [new Date(1952, 1, 1),  2637],
            [new Date(1953, 1, 1),  2682],
            [new Date(1954, 1, 1),  2730],
            [new Date(1955, 1, 1),  2782],
            [new Date(1956, 1, 1),  2835],
            [new Date(1957, 1, 1),  2891],
            [new Date(1958, 1, 1),  2948],
            [new Date(1959, 1, 1),  3001],
            [new Date(1960, 1, 1),  3043],
            [new Date(1961, 1, 1),  3084],
            [new Date(1962, 1, 1),  3140],
            [new Date(1963, 1, 1),  3210],
            [new Date(1964, 1, 1),  3281],
            [new Date(1965, 1, 1),  3350],
            [new Date(1966, 1, 1),  3421],
            [new Date(1967, 1, 1),  3490],
            [new Date(1968, 1, 1),  3562],
            [new Date(1969, 1, 1),  3637],
            [new Date(1970, 1, 1),  3713],
            [new Date(1971, 1, 1),  3790],
            [new Date(1972, 1, 1),  3867],
            [new Date(1973, 1, 1),  3942],
            [new Date(1974, 1, 1),  4017],
            [new Date(1975, 1, 1),  4089],
            [new Date(1976, 1, 1),  4160],
            [new Date(1977, 1, 1),  4232],
            [new Date(1978, 1, 1),  4304],
            [new Date(1979, 1, 1),  4379],
            [new Date(1980, 1, 1),  4451],
            [new Date(1981, 1, 1),  4534],
            [new Date(1982, 1, 1),  4615],
            [new Date(1983, 1, 1),  4696],
            [new Date(1984, 1, 1),  4775],
            [new Date(1985, 1, 1),  4856],
            [new Date(1986, 1, 1),  4941],
            [new Date(1987, 1, 1),  5027],
            [new Date(1988, 1, 1),  5115],
            [new Date(1989, 1, 1),  5201],
            [new Date(1990, 1, 1),  5289],
            [new Date(1991, 1, 1),  5372],
            [new Date(1992, 1, 1),  5456],
            [new Date(1993, 1, 1),  5538],
            [new Date(1994, 1, 1),  5619],
            [new Date(1995, 1, 1),  5699],
            [new Date(1996, 1, 1),  5779],
            [new Date(1997, 1, 1),  5858],
            [new Date(1998, 1, 1),  5935],
            [new Date(1999, 1, 1),  6012],
            [new Date(2000, 1, 1),  6089],
            [new Date(2001, 1, 1),  6165],
            [new Date(2002, 1, 1),  6242],
            [new Date(2003, 1, 1),  6319],
            [new Date(2004, 1, 1),  6396],
            [new Date(2005, 1, 1),  6473],
            [new Date(2006, 1, 1),  6551],
            [new Date(2007, 1, 1),  6630],
            [new Date(2008, 1, 1),  6709],
            [new Date(2009, 1, 1),  6788]
        ]);

        var a= 6000;

        var linearOptions = {
            title: 'World Population Since 1400 A.D. in Linear Scale',
            legend: 'none',
            hAxis: {
                title: 'Date'
            },
            vAxis: {
                title: 'Population (millions)',
                ticks: [0, a/4, a/2, 3*a/4, a]
            }
        };

        var linearChart = new google.visualization.LineChart(document.getElementById('chart_div'));
        linearChart.draw(data, linearOptions);
    }
</script>
</html>